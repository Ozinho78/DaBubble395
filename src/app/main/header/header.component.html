<header>
  <div class="header-img">
    <img src="img/header-img/da-bubble-header-logo.png" alt="" />
  </div>


  <!-- <div class="header-input">
    <input type="text" id="search-input" placeholder="Devspace durchsuchen" />
  </div> -->
  

  <div class="header-input">
    <input
      type="text"
      id="search-input"
      [formControl]="searchControl"
      placeholder="Devspace durchsuchen"
      (focus)="searchActive = true"
    />

    <!-- Ergebnisliste -->
    <div class="search-results-dropdown" *ngIf="searchResults.length > 0 && searchActive">
      <div *ngFor="let result of searchResults" class="search-result-item" (click)="openThreadModal(result)">
        <div class="channel-name">ğŸ”— {{ result.channelName }}</div>
      
        <!-- Wenn es ein Thread ist -->
        <div *ngIf="result.type === 'thread'" class="thread-title">
          ğŸ“ <strong>{{ result.title }}</strong>
        </div>
      
        <!-- Wenn es eine Message ist -->
        <div *ngIf="result.type === 'message'" class="message-preview">
          ğŸ—¨ï¸ <em>{{ result.text }}</em>
        </div>
      </div>
      
      <!-- Trefferanzahl und Hinweis -->
      <div class="search-counter" *ngIf="searchResults.length > 0">
        ğŸ” {{ searchResults.length }} Treffer gefunden
      </div>
      <small>(Press ESC to leave)</small>
    </div>
  </div>


  <div class="modal-overlay" *ngIf="modalOpen" (click)="modalOpen = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>{{ selectedThreadTitle }}</h3>
      <ul>
        <li *ngFor="let msg of selectedThreadMessages">
          <img [src]="'img/avatar/' + msg.senderAvatar" alt="">
          <strong>{{ msg.senderName }}:</strong>{{ msg.text }}
        </li>
      </ul>

      <div *ngIf="selectedThreadMessages.length === 0">
        <em>Keine Nachrichten gefunden.</em>
      </div>

      <div class="button-ctn" (click)="modalOpen = false">
        <button>SchlieÃŸen</button>
      </div><br>
    </div>
  </div>




  <div class="header-profile" (click)="toggleMenu()">
    <ng-container *ngIf="userName$ | async as user">
      <span>{{ user.name }}</span>
      <div class="profile-pic-wrapper">
        <img class="profile-pic" [src]="user.avatar" alt="Profilepicture" />
        <ng-container *ngIf="onlineStatus$ | async">
          <img
            class="profile-pic-online"
            src="img/header-img/profile-pic-online.png"
            alt="Online Indicator"
          />
        </ng-container>
      </div>
    </ng-container>
    <div class="arrow-wrapper">
      <img class="arrow-default" src="img/header-img/arrow-down.png" alt="" />
      <img
        class="arrow-hover"
        src="img/header-img/arrow-down-hover.png"
        alt=""
      />
    </div>
  </div>
</header>
<div class="overlayer" *ngIf="menuOpen" (click)="menuOpen = false">
  <div class="menu" *ngIf="menuOpen" (click)="$event.stopPropagation()">
    <p (click)="toggleProfileEdit()" class="profile">Profil</p>
    <p (click)="logout()" class="log-out">Log out</p>
  </div>
  <app-profile-detail
    *ngIf="profileEditOpen"
    [userName]="userName$ | async"
    (close)="closeProfile()"
  ></app-profile-detail>
</div>
